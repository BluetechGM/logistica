SELECT 
  c.id_checklist,
  c.data_checklist,
  c.usuario_execucao,
  c.filial_id,
  c.placa,
  c.resultado_final,
  c.observacoes,
  c.decisao_analista,
  c.analista_decisao,
  c.data_decisao,
  COUNT(CASE WHEN i.status IN ('NC','NAO_CONFORME') THEN 1 END) AS qtd_nc
FROM compras_so.checklist_semanal_motos c
LEFT JOIN compras_so.checklist_semanal_itens i
  ON i.id_checklist = c.id_checklist
GROUP BY 
  c.id_checklist, c.data_checklist, c.usuario_execucao, c.filial_id,
  c.placa, c.resultado_final, c.observacoes,
  c.decisao_analista, c.analista_decisao, c.data_decisao
ORDER BY c.data_checklist DESC;
