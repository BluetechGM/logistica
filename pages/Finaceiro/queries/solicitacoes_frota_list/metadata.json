{
  "gitSyncId": "684accaaccd99e1ff73d47d3_26c48e94-3796-403b-af21-dc5d4ba0a31a",
  "id": "Finaceiro_solicitacoes_frota_list",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "SELECT \n    s.id as solicitacao_id,\n    s.placa,\n    s.odometro_atual,\n    s.odometro_prox_troca,\n    s.data_prox_manutencao,\n    s.cidade,\n    s.criado_por,\n    s.servico,\n    s.status,\n    s.motivo_reprovacao,\n    s.data_abertura,\n    s.id_solicitacao,\n    s.filial_id,\n    s.id_solicitante,\n    s.nome_solicitante,\n    s.link_orcamento_pdf,\n    s.link_fotos_orcamento,\n    s.nfe_servico_pdf,\n    s.nfe_produtos_pdf,\n    s.observacoes,\n    s.tipo_incidente,\n    s.foto_comprovante,\n\t\ts.lancado_winthor,\n\t\ts.recnum,\n    COUNT(p.id) as quantidade_produtos,\n    COALESCE(SUM(p.preco), 0) as valor_total_produtos,\n    COALESCE(AVG(p.preco), 0) as valor_medio_produtos,\n    COALESCE(MIN(p.preco), 0) as menor_preco_produto,\n    COALESCE(MAX(p.preco), 0) as maior_preco_produto,\n    STRING_AGG(DISTINCT p.peca, ', ') as lista_produtos,\n    STRING_AGG(DISTINCT p.marca, ', ') as lista_marcas\nFROM compras_so.solicitacoes_frota s\nLEFT JOIN compras_so.produtos_solicitacao p \n       ON s.id_solicitacao = p.id_solicitacao \n      AND p.ativo = TRUE\nWHERE \n    s.ativo = TRUE\n\t\t\tAND (\n\t\t\t\t{{appsmith.store.permissao_query}} = true\n\t\t\t\tOR s.id_solicitante = '{{appsmith.store.matricula}}'\n\t\t\t)\nGROUP BY \n    s.id, s.placa, s.odometro_atual, s.odometro_prox_troca, \n    s.data_prox_manutencao, s.cidade, s.criado_por, s.servico, \n    s.status, s.motivo_reprovacao, s.data_abertura, s.id_solicitacao,\n    s.filial_id, s.id_solicitante, s.nome_solicitante, \n    s.link_orcamento_pdf, s.link_fotos_orcamento, \n    s.nfe_servico_pdf, s.nfe_produtos_pdf,\n    s.observacoes, s.tipo_incidente, s.foto_comprovante\nORDER BY s.data_abertura DESC;\n",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": false
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "CANDIDATOS",
      "isAutoGenerated": false,
      "name": "CANDIDATOS",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "name": "solicitacoes_frota_list",
    "pageId": "Finaceiro",
    "runBehaviour": "ON_PAGE_LOAD",
    "userSetOnLoad": true
  }
}