{
  "animateLoading": true,
  "borderColor": "transparent",
  "borderOpacity": "0",
  "borderRadius": "{{appsmith.theme.borderRadius.appBorderRadius}}",
  "borderWidth": "0",
  "bottomRow": 175,
  "boxShadow": "none",
  "dynamicBindingPathList": [
    {
      "key": "borderRadius"
    },
    {
      "key": "srcDoc"
    }
  ],
  "dynamicTriggerPathList": [],
  "flexVerticalAlignment": "start",
  "isLoading": false,
  "isVisible": true,
  "key": "wcjiwgvzsi",
  "leftColumn": 0,
  "mobileBottomRow": 41,
  "mobileLeftColumn": 8,
  "mobileRightColumn": 32,
  "mobileTopRow": 9,
  "needsErrorInfo": false,
  "originalBottomRow": 175,
  "originalTopRow": 120,
  "parentColumnSpace": 18.56015625,
  "parentId": "kytv2aa0d3",
  "parentRowSpace": 10,
  "renderMode": "CANVAS",
  "responsiveBehavior": "fill",
  "rightColumn": 64,
  "source": "",
  "srcDoc": "<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<!--\n    TEMPLATE APPSMITH - Sistema de Manuten√ß√£o de Frotas - COMPLETO\n    \n    VARI√ÅVEIS DIN√ÇMICAS USADAS:\n    - {{appsmith.store.itemSelecionado}} - Dados da solicita√ß√£o selecionada\n    - {{produtos_mf.data}} - Array de produtos da query produtos_mf\n-->\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Or√ßamento Completo - Manuten√ß√£o de Frotas</title>\n\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            background: #fff;\n            padding: 20px;\n            min-height: 100vh;\n        }\n\n        .container {\n            max-width: 1400px;\n            margin: 0 auto;\n            background: white;\n            border-radius: 16px;\n            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n            overflow: hidden;\n        }\n\n        .header {\n            background: linear-gradient(135deg, #155A87 0%, #348EB6 100%);\n            color: white;\n            padding: 30px;\n            position: relative;\n            overflow: hidden;\n        }\n\n        .header::before {\n            content: '';\n            position: absolute;\n            top: -50%;\n            right: -10%;\n            width: 400px;\n            height: 400px;\n            background: rgba(255, 255, 255, 0.1);\n            border-radius: 50%;\n        }\n\n        .header-content {\n            position: relative;\n            z-index: 1;\n        }\n\n        .header h1 {\n            font-size: 32px;\n            font-weight: 700;\n            margin-bottom: 8px;\n            display: flex;\n            align-items: center;\n            gap: 12px;\n        }\n\n        .header p {\n            font-size: 16px;\n            opacity: 0.95;\n        }\n\n        .solicitacao-card {\n            padding: 30px;\n        }\n\n        /* Badge de Status */\n        .status-badges {\n            display: flex;\n            gap: 12px;\n            flex-wrap: wrap;\n            margin-bottom: 25px;\n        }\n\n        .badge {\n            padding: 8px 16px;\n            border-radius: 20px;\n            font-size: 13px;\n            font-weight: 600;\n            text-transform: uppercase;\n            letter-spacing: 0.5px;\n        }\n\n        .badge-aprovado {\n            background: linear-gradient(135deg, #4CAF50, #2E7D32);\n            color: white;\n        }\n\n        .badge-reprovado {\n            background: linear-gradient(135deg, #EF5350, #C62828);\n            color: white;\n        }\n\n        .badge-aberto {\n            background: linear-gradient(135deg, #FFB74D, #EF6C00);\n            color: white;\n        }\n\n        .badge-placa {\n            background: linear-gradient(135deg, #155A87, #348EB6);\n            color: white;\n            font-size: 18px;\n            padding: 10px 20px;\n            letter-spacing: 2px;\n        }\n\n        /* Grid de Informa√ß√µes */\n        .info-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));\n            gap: 20px;\n            margin-bottom: 25px;\n        }\n\n        .info-card {\n            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);\n            padding: 20px;\n            border-radius: 12px;\n            border-left: 5px solid #155A87;\n            transition: all 0.3s ease;\n        }\n\n        .info-card:hover {\n            transform: translateY(-3px);\n            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);\n        }\n\n        .info-card h3 {\n            color: #155A87;\n            font-size: 13px;\n            font-weight: 700;\n            margin-bottom: 10px;\n            text-transform: uppercase;\n            letter-spacing: 1px;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .info-card p {\n            color: #495057;\n            font-size: 14px;\n            line-height: 1.6;\n            margin: 5px 0;\n        }\n\n        .info-card strong {\n            color: #212529;\n            font-weight: 600;\n        }\n\n        /* Se√ß√£o de Servi√ßos */\n        .section-box {\n            background: #f8f9fa;\n            padding: 25px;\n            border-radius: 12px;\n            margin: 20px 0;\n            border: 2px solid #e9ecef;\n        }\n\n        .section-box h3 {\n            color: #155A87;\n            font-size: 18px;\n            font-weight: 700;\n            margin-bottom: 15px;\n            display: flex;\n            align-items: center;\n            gap: 10px;\n        }\n\n        .section-box p {\n            color: #495057;\n            font-size: 15px;\n            line-height: 1.7;\n        }\n\n        /* Cards de Valor */\n        .valores-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n            gap: 15px;\n            margin-top: 20px;\n        }\n\n        .valor-card {\n            background: white;\n            padding: 18px;\n            border-radius: 10px;\n            text-align: center;\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);\n            border: 2px solid #e9ecef;\n            transition: all 0.3s ease;\n        }\n\n        .valor-card:hover {\n            border-color: #155A87;\n            transform: scale(1.05);\n        }\n\n        .valor-card .label {\n            font-size: 11px;\n            color: #6c757d;\n            font-weight: 600;\n            text-transform: uppercase;\n            margin-bottom: 8px;\n        }\n\n        .valor-card .value {\n            font-size: 20px;\n            color: #155A87;\n            font-weight: 800;\n        }\n\n        /* Tabela de Produtos */\n        .produtos-section {\n            margin: 30px 0;\n        }\n\n        .produtos-section h2 {\n            color: #155A87;\n            font-size: 24px;\n            font-weight: 700;\n            margin-bottom: 20px;\n            text-align: center;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 12px;\n        }\n\n        .tabela-produtos {\n            width: 100%;\n            border-collapse: separate;\n            border-spacing: 0;\n            background: white;\n            border-radius: 12px;\n            overflow: hidden;\n            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);\n        }\n\n        .tabela-produtos thead {\n            background: linear-gradient(135deg, #155A87, #348EB6);\n            color: white;\n        }\n\n        .tabela-produtos th {\n            padding: 15px 10px;\n            text-align: left;\n            font-weight: 700;\n            font-size: 11px;\n            text-transform: uppercase;\n            letter-spacing: 0.8px;\n        }\n\n        .tabela-produtos td {\n            padding: 14px 10px;\n            border-bottom: 1px solid #f0f0f0;\n            font-size: 13px;\n            vertical-align: middle;\n        }\n\n        .tabela-produtos tbody tr {\n            transition: all 0.3s ease;\n        }\n\n        .tabela-produtos tbody tr:hover {\n            background-color: #f8f9fa;\n            transform: scale(1.01);\n        }\n\n        .tabela-produtos tbody tr:last-child td {\n            border-bottom: none;\n        }\n\n        .produto-id {\n            font-weight: 700;\n            color: #155A87;\n            font-size: 12px;\n        }\n\n        .produto-nome {\n            font-weight: 600;\n            color: #212529;\n        }\n\n        .produto-marca {\n            background: linear-gradient(135deg, #667eea, #764ba2);\n            color: white;\n            padding: 4px 10px;\n            border-radius: 12px;\n            font-size: 11px;\n            font-weight: 600;\n            display: inline-block;\n        }\n\n        .produto-preco {\n            text-align: right;\n            font-weight: 700;\n            color: #2E7D32;\n        }\n\n        .produto-total {\n            text-align: right;\n            font-weight: 800;\n            color: #2E7D32;\n            background: #E8F5E9;\n            padding: 6px 10px;\n            border-radius: 8px;\n            font-size: 14px;\n        }\n\n        .status-ok {\n            background: #E8F5E9;\n            color: #2E7D32;\n            padding: 4px 10px;\n            border-radius: 12px;\n            font-weight: 600;\n            font-size: 11px;\n            text-align: center;\n        }\n\n        .status-divergencia {\n            background: #FFEBEE;\n            color: #D32F2F;\n            padding: 4px 10px;\n            border-radius: 12px;\n            font-weight: 600;\n            font-size: 11px;\n            text-align: center;\n        }\n\n        /* Totais */\n        .totais-section {\n            background: linear-gradient(135deg, #155A87, #348EB6);\n            color: white;\n            padding: 25px;\n            border-radius: 12px;\n            margin-top: 20px;\n        }\n\n        .linha-total {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 10px 0;\n            border-bottom: 1px solid rgba(255, 255, 255, 0.2);\n        }\n\n        .linha-total:last-child {\n            border-bottom: none;\n            padding-top: 15px;\n            margin-top: 10px;\n            border-top: 2px solid rgba(255, 255, 255, 0.5);\n            font-size: 20px;\n            font-weight: 800;\n        }\n\n        /* Documentos */\n        .documentos-section {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n            gap: 15px;\n            margin: 25px 0;\n        }\n\n        .doc-card {\n            background: white;\n            border: 2px solid #e9ecef;\n            border-radius: 12px;\n            padding: 20px;\n            text-align: center;\n            transition: all 0.3s ease;\n        }\n\n        .doc-card:hover {\n            border-color: #155A87;\n            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);\n        }\n\n        .doc-card h4 {\n            color: #155A87;\n            font-size: 14px;\n            font-weight: 700;\n            margin-bottom: 12px;\n            text-transform: uppercase;\n        }\n\n        .doc-link {\n            display: inline-block;\n            background: linear-gradient(135deg, #155A87, #348EB6);\n            color: white;\n            padding: 10px 20px;\n            border-radius: 8px;\n            text-decoration: none;\n            font-weight: 600;\n            font-size: 13px;\n            transition: all 0.3s ease;\n        }\n\n        .doc-link:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 6px 15px rgba(21, 90, 135, 0.4);\n        }\n\n        .doc-unavailable {\n            color: #6c757d;\n            font-style: italic;\n            font-size: 13px;\n        }\n\n        /* Miniaturas de Imagens e PDFs */\n        .img-thumbnail {\n            width: 100%;\n            max-width: 200px;\n            height: 150px;\n            object-fit: cover;\n            border-radius: 8px;\n            border: 3px solid #155A87;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n        }\n\n        .img-thumbnail:hover {\n            transform: scale(1.05);\n            box-shadow: 0 8px 20px rgba(21, 90, 135, 0.3);\n            border-color: #348EB6;\n        }\n\n        .pdf-preview {\n            width: 100%;\n            max-width: 200px;\n            height: 150px;\n            border-radius: 8px;\n            border: 3px solid #155A87;\n            overflow: hidden;\n            position: relative;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n        }\n\n        .pdf-preview:hover {\n            transform: scale(1.05);\n            box-shadow: 0 8px 20px rgba(21, 90, 135, 0.3);\n            border-color: #348EB6;\n        }\n\n        .pdf-preview iframe {\n            width: 100%;\n            height: 100%;\n            border: none;\n            pointer-events: none;\n        }\n\n        .pdf-overlay {\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0, 0, 0, 0.1);\n            display: flex;\n            align-items: flex-end;\n            justify-content: center;\n            padding: 5px;\n            opacity: 0;\n            transition: opacity 0.3s ease;\n        }\n\n        .pdf-preview:hover .pdf-overlay {\n            opacity: 1;\n        }\n\n        .pdf-badge {\n            background: rgba(21, 90, 135, 0.9);\n            color: white;\n            padding: 4px 10px;\n            border-radius: 12px;\n            font-size: 10px;\n            font-weight: 700;\n            text-transform: uppercase;\n        }\n\n        .img-container {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            gap: 10px;\n        }\n\n        .img-label {\n            font-size: 11px;\n            color: #666;\n            text-align: center;\n            margin-top: 5px;\n            font-weight: 600;\n        }\n\n        .doc-preview {\n            margin-top: 10px;\n        }\n\n        /* Modal de Preview */\n        .modal-overlay {\n            display: none;\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0, 0, 0, 0.95);\n            z-index: 9999;\n            justify-content: center;\n            align-items: center;\n        }\n\n        .modal-overlay.active {\n            display: flex;\n        }\n\n        .modal-content {\n            position: relative;\n            width: 90%;\n            max-width: 1200px;\n            max-height: 95%;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            padding: 20px;\n        }\n\n        .modal-image {\n            width: auto;\n            height: auto;\n            max-width: 100%;\n            max-height: 85vh;\n            min-width: 600px;\n            min-height: 400px;\n            object-fit: contain;\n            border-radius: 12px;\n            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);\n            cursor: zoom-in;\n            transition: transform 0.3s ease;\n            background: white;\n        }\n\n        .modal-image.zoomed {\n            cursor: zoom-out;\n            transform: scale(1.8);\n            min-width: auto;\n            min-height: auto;\n        }\n        \n        @media (max-width: 768px) {\n            .modal-image {\n                min-width: 300px;\n                min-height: 200px;\n            }\n        }\n\n        .modal-close {\n            position: absolute;\n            top: -50px;\n            right: 0;\n            background: white;\n            border: none;\n            width: 40px;\n            height: 40px;\n            border-radius: 50%;\n            font-size: 24px;\n            cursor: pointer;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            transition: all 0.3s ease;\n        }\n\n        .modal-close:hover {\n            background: #ff5555;\n            color: white;\n            transform: rotate(90deg);\n        }\n\n        .modal-actions {\n            margin-top: 20px;\n            display: flex;\n            gap: 10px;\n        }\n\n        .modal-btn {\n            background: white;\n            color: #155A87;\n            border: none;\n            padding: 10px 20px;\n            border-radius: 8px;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.3s ease;\n        }\n\n        .modal-btn:hover {\n            background: #155A87;\n            color: white;\n            transform: translateY(-2px);\n        }\n\n        .modal-title {\n            position: absolute;\n            top: -50px;\n            left: 0;\n            color: white;\n            font-size: 18px;\n            font-weight: 700;\n        }\n\n        /* MODAL TELA CHEIA - GALERIA */\n        .modal-fullscreen {\n            display: none;\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0, 0, 0, 0.95);\n            z-index: 9999;\n            justify-content: center;\n            align-items: center;\n            flex-direction: column;\n        }\n\n        .modal-fullscreen.active {\n            display: flex;\n        }\n\n        .modal-fullscreen img {\n            max-width: 90%;\n            max-height: 80vh;\n            object-fit: contain;\n            border-radius: 12px;\n            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);\n        }\n\n        .modal-close-btn {\n            position: absolute;\n            top: 20px;\n            right: 30px;\n            background: rgba(255, 255, 255, 0.9);\n            border: none;\n            width: 50px;\n            height: 50px;\n            border-radius: 50%;\n            font-size: 28px;\n            cursor: pointer;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            transition: all 0.3s ease;\n            color: #333;\n            z-index: 10001;\n        }\n\n        .modal-close-btn:hover {\n            background: #ff5555;\n            color: white;\n            transform: scale(1.1);\n        }\n\n        .modal-nav {\n            display: flex;\n            gap: 15px;\n            margin-top: 20px;\n        }\n\n        .modal-nav button {\n            background: linear-gradient(135deg, #155A87, #348EB6);\n            color: white;\n            border: none;\n            padding: 12px 25px;\n            border-radius: 8px;\n            font-size: 14px;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.3s ease;\n        }\n\n        .modal-nav button:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 6px 20px rgba(21, 90, 135, 0.4);\n        }\n\n        .modal-nav button:disabled {\n            background: #666;\n            cursor: not-allowed;\n            transform: none;\n        }\n\n        .modal-counter {\n            color: white;\n            font-size: 16px;\n            margin-top: 15px;\n            font-weight: 600;\n        }\n\n        .modal-foto-title {\n            color: white;\n            font-size: 20px;\n            font-weight: 700;\n            margin-bottom: 20px;\n        }\n\n        /* MODAL V√çDEO TELA CHEIA */\n        .modal-video {\n            display: none;\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0, 0, 0, 0.95);\n            z-index: 9999;\n            justify-content: center;\n            align-items: center;\n            flex-direction: column;\n        }\n\n        .modal-video.active {\n            display: flex;\n        }\n\n        .modal-video video {\n            max-width: 90%;\n            max-height: 80vh;\n            border-radius: 12px;\n            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);\n        }\n\n        /* Footer */\n        .footer {\n            background: #f8f9fa;\n            padding: 20px 30px;\n            border-top: 2px solid #e9ecef;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            flex-wrap: wrap;\n            gap: 15px;\n        }\n\n        .footer-info {\n            font-size: 12px;\n            color: #6c757d;\n        }\n\n        /* Responsividade */\n        @media (max-width: 768px) {\n            .info-grid {\n                grid-template-columns: 1fr;\n            }\n\n            .valores-grid {\n                grid-template-columns: repeat(2, 1fr);\n            }\n\n            .tabela-produtos {\n                font-size: 11px;\n            }\n\n            .tabela-produtos th,\n            .tabela-produtos td {\n                padding: 10px 6px;\n            }\n\n            .header h1 {\n                font-size: 24px;\n            }\n\n            .footer {\n                flex-direction: column;\n                text-align: center;\n            }\n        }\n    </style>\n</head>\n\n<body>\n    <div class=\"container\">\n        <!-- Header -->\n        <div class=\"header\">\n            <div class=\"header-content\">\n                <h1>üîß Or√ßamento Completo - Manuten√ß√£o de Frotas</h1>\n                <p>Sistema Integrado de Gest√£o de Manuten√ß√£o</p>\n            </div>\n        </div>\n\n        <div class=\"solicitacao-card\">\n            <!-- Badges de Status -->\n            <div class=\"status-badges\">\n                <div class=\"badge badge-placa\">{{appsmith.store.itemSelecionado.placa}}</div>\n                <div class=\"badge {{\n  (() => {\n    const status = (appsmith.store.itemSelecionado?.status || \"\").toLowerCase();\n    if (status.includes('aprov')) return 'badge-aprovado';\n    if (status.includes('reprov')) return 'badge-reprovado';\n    return 'badge-aberto';\n  })()\n}}\">\n                    {{ appsmith.store.itemSelecionado?.status || \"\" }}\n                </div>\n\n                <div class=\"badge\" style=\"background: linear-gradient(135deg, #667eea, #764ba2); color: white;\">\n                    ID: {{appsmith.store.itemSelecionado?.solicitacao_id}}\n                </div>\n            </div>\n\n            <!-- Grid de Informa√ß√µes Principais -->\n            <div class=\"info-grid\">\n                <!-- Ve√≠culo -->\n                <div class=\"info-card\">\n                    <h3>üöó Dados do Ve√≠culo</h3>\n                    <p><strong>Placa:</strong> {{appsmith.store.itemSelecionado?.placa}}</p>\n                    <p><strong>Od√¥metro Atual:</strong> {{\n                        Number(appsmith.store.itemSelecionado?.odometro_atual).toLocaleString('pt-BR') }}\n                        km</p>\n                    <p><strong>Pr√≥xima Troca:</strong> {{\n                        Number(appsmith.store.itemSelecionado?.odometro_prox_troca).toLocaleString('pt-BR') }}\n                        km</p>\n                    <p><strong>Pr√≥x. Manuten√ß√£o:</strong> {{ new\n                        Date(appsmith.store.itemSelecionado?.data_prox_manutencao).toLocaleDateString('pt-BR') }}\n                    </p>\n                </div>\n\n                <!-- Localiza√ß√£o -->\n                <div class=\"info-card\" style=\"border-left-color: #348EB6;\">\n                    <h3>üìç Localiza√ß√£o</h3>\n                    <p><strong>Cidade:</strong> {{appsmith.store.itemSelecionado?.cidade}}</p>\n                    <p><strong>Filial ID:</strong> {{appsmith.store.itemSelecionado?.filial_id}}</p>\n                </div>\n\n                <!-- Solicitante -->\n                <div class=\"info-card\" style=\"border-left-color: #667eea;\">\n                    <h3>üë§ Solicitante</h3>\n                    <p><strong>Nome:</strong> {{appsmith.store.itemSelecionado?.nome_solicitante}}</p>\n                    <p><strong>ID:</strong> {{appsmith.store.itemSelecionado?.id_solicitante}}</p>\n                    <p><strong>Criado por:</strong> {{appsmith.store.itemSelecionado?.criado_por}}</p>\n                </div>\n\n                <!-- Datas -->\n                <div class=\"info-card\" style=\"border-left-color: #764ba2;\">\n                    <h3>üìÖ Datas</h3>\n                    <p><strong>Abertura:</strong> {{new\n                        Date('{{appsmith.store.itemSelecionado?.data_abertura}}').toLocaleString('pt-BR')}}</p>\n                    <p><strong>ID Solicita√ß√£o:</strong> {{appsmith.store.itemSelecionado?.id_solicitacao}}</p>\n                </div>\n<!-- üè¶ Dados Financeiros -->\n<div class=\"info-card\" style=\"border-left-color: #2E7D32;\">\n    <h3>üè¶ Dados Financeiros</h3>\n\n    <p>\n        <strong>CNPJ:</strong>\n        {{\n            (() => {\n                const cnpj = appsmith.store.itemSelecionado?.cnpj;\n                if (!cnpj || cnpj === 'null' || String(cnpj).trim() === '') {\n                    return 'N√£o informado';\n                }\n                return cnpj.replace(\n                    /^(\\d{2})(\\d{3})(\\d{3})(\\d{4})(\\d{2})$/,\n                    '$1.$2.$3/$4-$5'\n                );\n            })()\n        }}\n    </p>\n\n    <p>\n        <strong>Chave PIX:</strong><br />\n        <span\n            style=\"\n                word-break: break-all;\n                background: #E8F5E9;\n                padding: 6px 8px;\n                border-radius: 6px;\n                display: inline-block;\n                font-family: monospace;\n                font-size: 13px;\n            \"\n        >\n            {{\n                appsmith.store.itemSelecionado?.chave_pix &&\n                appsmith.store.itemSelecionado?.chave_pix !== 'null'\n                    ? appsmith.store.itemSelecionado.chave_pix\n                    : 'N√£o informada'\n            }}\n        </span>\n    </p>\n</div>\n\n\n                <!-- Tipo de Incidente -->\n                <div class=\"info-card\" style=\"border-left-color: #EF6C00;\">\n                    <h3>‚ö†Ô∏è Tipo de Incidente</h3>\n                    <p><strong>{{appsmith.store.itemSelecionado?.tipo_incidente || 'N√£o especificado'}}</strong></p>\n                </div>\n            </div>\n\n            <!-- Servi√ßo Solicitado -->\n            <div class=\"section-box\"\n                style=\"background: linear-gradient(135deg, #E3F2FD, #BBDEFB); border-color: #2196F3;\">\n                <h3>üîß Servi√ßos Solicitados</h3>\n                <p>{{appsmith.store.itemSelecionado?.servico}}</p>\n            </div>\n\n\n            <!-- Tabela de Produtos Detalhada -->\n            <div class=\"produtos-section\">\n                <h2>üìã Or√ßamento Detalhado - Produtos e Servi√ßos</h2>\n\n                <table class=\"tabela-produtos\">\n                    <thead>\n                        <tr>\n                            <th>ID</th>\n                            <th>Produto</th>\n                            <th>Marca</th>\n                            <th>Servi√ßo/Tipo</th>\n                            <th style=\"text-align: center;\">Qtd</th>\n                            <th style=\"text-align: right;\">Pre√ßo Unit.</th>\n                            <th style=\"text-align: right;\">Total Pe√ßas</th>\n                            <th style=\"text-align: right;\">M√£o de Obra</th>\n                            <th style=\"text-align: right;\">Total Geral</th>\n                            <th style=\"text-align: center;\">Status</th>\n                            <th>Observa√ß√µes</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        {{produtos_mf.data.map(p => {\n                        const valorServico = Number(p.valor_servico || 0);\n                        const totalPecas = Number(p.preco_total || 0);\n                        const totalGeral = totalPecas + valorServico;\n\n                        return `\n                        <tr>\n                            <td class=\"produto-id\">${p.produto_id}</td>\n                            <td class=\"produto-nome\">${p.nome_produto}</td>\n                            <td><span class=\"produto-marca\">${p.marca}</span></td>\n                            <td style=\"font-size: 11px; color: #666; max-width: 150px; word-wrap: break-word;\">\n                                ${p.servico_peca || 'N/A'}</td>\n                            <td style=\"text-align: center; font-weight: 700; font-size: 14px;\">${p.quantidade}</td>\n                            <td class=\"produto-preco\">R$ ${Number(p.preco_unitario || 0).toFixed(2).replace('.', ',')}\n                            </td>\n                            <td class=\"produto-preco\" style=\"background: #E3F2FD;\">R$\n                                ${totalPecas.toFixed(2).replace('.', ',')}</td>\n                            <td class=\"produto-preco\" style=\"background: #FFF3E0; color: #E65100; font-weight: 700;\">\n                                ${valorServico > 0 ? 'R$ ' + valorServico.toFixed(2).replace('.', ',') : '-'}\n                            </td>\n                            <td class=\"produto-total\">R$ ${totalGeral.toFixed(2).replace('.', ',')}</td>\n                            <td>\n                                <div class=\"${p.status_calculo === 'OK' ? 'status-ok' : 'status-divergencia'}\">\n                                    ${p.status_calculo || 'N/A'}\n                                </div>\n                            </td>\n                            <td\n                                style=\"font-size: 11px; color: #666; font-style: italic; max-width: 120px; word-wrap: break-word;\">\n                                ${p.observacoes_produto || '-'}</td>\n                        </tr>\n                        `}).join('')}}\n                    </tbody>\n                </table>\n\n                <!-- Totais -->\n                <div class=\"totais-section\">\n                    <div class=\"linha-total\">\n                        <span>Total de Produtos/Servi√ßos:</span>\n                        <span>{{produtos_mf.data.length}} itens</span>\n                    </div>\n                    <div class=\"linha-total\">\n                        <span>Total de Itens (Quantidade):</span>\n                        <span>{{produtos_mf.data.reduce((sum, p) => sum + p.quantidade, 0)}} unidades</span>\n                    </div>\n                    <div class=\"linha-total\"\n                        style=\"background: rgba(255,255,255,0.1); padding: 8px; border-radius: 4px;\">\n                        <span>üí∞ Total em Pe√ßas:</span>\n                        <span>R$ {{produtos_mf.data.reduce((sum, p) => sum + Number(p.preco_total || 0),\n                            0).toFixed(2).replace('.', ',')}}</span>\n                    </div>\n                    <div class=\"linha-total\"\n                        style=\"background: rgba(255,255,255,0.1); padding: 8px; border-radius: 4px;\">\n                        <span>üîß Total em M√£o de Obra:</span>\n                        <span>R$ {{produtos_mf.data.reduce((sum, p) => sum + Number(p.valor_servico || 0),\n                            0).toFixed(2).replace('.', ',')}}</span>\n                    </div>\n                    <div class=\"linha-total\">\n                        <span>üíé Valor Total do Or√ßamento:</span>\n                        <span>R$ {{produtos_mf.data.reduce((sum, p) => sum + Number(p.preco_total || 0) +\n                            Number(p.valor_servico || 0), 0).toFixed(2).replace('.', ',')}}</span>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Documentos e Comprovantes -->\n            <div class=\"section-box\"\n                style=\"background: linear-gradient(135deg, #FFF9C4, #FFF59D); border-color: #FBC02D;\">\n                <h3>üìÑ Documentos e Comprovantes</h3>\n\n                <div class=\"documentos-section\">\n                    <!-- Or√ßamento PDF -->\n                    <div class=\"doc-card\">\n                        <h4>üìë Or√ßamento</h4>\n                        <div class=\"doc-preview\">\n                            {{\n                            (() => {\n                            let link = appsmith.store.itemSelecionado?.link_orcamento_pdf;\n                            if (link && link !== 'null' && String(link).trim() !== '') {\n                            link = String(link).trim().replace(/[\\r\\n\\t]/g, '');\n\n                            const isImage = /\\.(jpg|jpeg|png|gif|webp)$/i.test(link);\n                            if (isImage) {\n                            return `\n                            <div class=\"img-container\">\n                                <div style=\"cursor:pointer\" onclick=\"openModal('${link}', 'Or√ßamento', '${link}')\">\n                                    <img src=\"${link}\" alt=\"Or√ßamento\" class=\"img-thumbnail\"\n                                        onerror=\"this.parentElement.innerHTML='<p style=color:#999>‚ùå Erro ao carregar</p>'\" />\n                                </div>\n                                <div class=\"img-label\">üñºÔ∏è Clique para ampliar</div>\n                            </div>\n                            `;\n                            } else {\n                            // Preview maior para PDF\n                            let previewImg = link;\n                            let previewImgLarge = link;\n                            if (link.includes('cloudinary.com')) {\n                                // Preview pequeno para o card\n                                previewImg = link.replace('/upload/', '/upload/f_jpg,pg_1,w_400,h_300,c_fit,q_auto/');\n                                // Preview grande para o modal\n                                previewImgLarge = link.replace('/upload/', '/upload/f_jpg,pg_1,w_1200,h_900,c_fit,q_auto/');\n                            }\n                            return `\n                            <div class=\"img-container\">\n                                <div style=\"cursor:pointer\"\n                                    onclick=\"openModal('${previewImgLarge}', 'Or√ßamento (PDF)', '${link}')\">\n                                    <img src=\"${previewImg}\" alt=\"Preview PDF\" class=\"img-thumbnail\" style=\"width: 200px; height: 150px; object-fit: contain; background: white;\"\n                                        onerror=\"this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22150%22%3E%3Crect fill=%22%23f0f0f0%22 width=%22200%22 height=%22150%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 font-family=%22Arial%22 font-size=%2224%22 fill=%22%23999%22%3EüìÑ PDF%3C/text%3E%3C/svg%3E'\" />\n                                </div>\n                                <div class=\"img-label\">üì• Clique para visualizar</div>\n                            </div>\n                            `;\n                            }\n                            }\n                            return '<p class=\"doc-unavailable\">N√£o anexado</p>';\n                            })()\n                            }}\n                        </div>\n                    </div>\n\n                    <!-- Fotos Or√ßamento - CORRIGIDO -->\n                    <div class=\"doc-card\">\n                        <h4>üì∏ Fotos do Or√ßamento</h4>\n                        <div class=\"doc-preview\">\n                            {{\n                            (() => {\n                            try {\n                                let link = appsmith.store.itemSelecionado?.link_fotos_orcamento;\n                                \n                                // Verifica√ß√£o completa para valores inv√°lidos\n                                if (!link || link === null || link === undefined || link === 'null' || link === 'undefined' || String(link).trim() === '' || link === '[]') {\n                                    return '<p class=\"doc-unavailable\">Sem Anexo</p>';\n                                }\n                                \n                                let fotos = [];\n                                try {\n                                    const parsed = JSON.parse(link);\n                                    if (Array.isArray(parsed) && parsed.length > 0) {\n                                        fotos = parsed;\n                                    }\n                                } catch (e) {\n                                    // Se n√£o for JSON v√°lido, tenta usar como URL √∫nica\n                                    if (link && String(link).trim() !== '') {\n                                        fotos = [link];\n                                    }\n                                }\n                                \n                                if (fotos.length === 0) {\n                                    return '<p class=\"doc-unavailable\">Sem Anexo</p>';\n                                }\n                                \n                                // Converte o array para Base64 para evitar problemas com aspas\n                                const fotosBase64 = btoa(encodeURIComponent(JSON.stringify(fotos)));\n                                \n                                let html = '<div style=\"display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;\">';\n                                fotos.forEach((foto, index) => {\n                                    const fotoUrl = String(foto).trim().replace(/[\\r\\n\\t]/g, '');\n                                    html += '<div class=\"img-container\" style=\"flex: 0 0 auto;\"><img src=\"' + fotoUrl + '\" alt=\"Foto ' + (index + 1) + '\" class=\"img-thumbnail\" style=\"width: 100px; height: 75px; object-fit: cover; cursor: pointer;\" onclick=\"abrirGaleria(' + index + ', \\'' + fotosBase64 + '\\')\" onerror=\"this.style.display=\\'none\\'\" /><div class=\"img-label\">Foto ' + (index + 1) + '</div></div>';\n                                });\n                                html += '</div>';\n                                html += '<div style=\"margin-top: 10px; font-size: 12px; color: #666; text-align: center;\">üîç Clique para ampliar em tela cheia | üì∑ ' + fotos.length + ' foto(s)</div>';\n                                \n                                return html;\n                            } catch (error) {\n                                return '<p class=\"doc-unavailable\">Sem Anexo</p>';\n                            }\n                            })()\n                            }}\n                        </div>\n                    </div>\n\n\n                    <!-- V√≠deo Or√ßamento -->\n                    <div class=\"doc-card\">\n                        <h4>üé¨ V√≠deo</h4>\n                        <div class=\"doc-preview\">\n                            {{\n                            (() => {\n                                let link = appsmith.store.itemSelecionado?.link_video_orcamento;\n                                \n                                // Verifica√ß√£o completa para valores inv√°lidos\n                                if (!link || link === null || link === undefined || link === 'null' || link === 'undefined' || String(link).trim() === '') {\n                                    return '<p class=\"doc-unavailable\">Sem Anexo</p>';\n                                }\n                                \n                                link = String(link).trim().replace(/[\\r\\n\\t]/g, '');\n                                return '<div class=\"img-container\"><video src=\"' + link + '\" style=\"width: 100%; max-width: 180px; height: 120px; border-radius: 8px; border: 3px solid #155A87; object-fit: cover; cursor: pointer;\" onclick=\"abrirVideoTelaCheia(\\'' + link + '\\')\" onerror=\"this.parentElement.innerHTML=\\'<p class=doc-unavailable>Sem Anexo</p>\\'\"></video><div class=\"img-label\">üîç Clique para tela cheia</div></div>';\n                            })()\n                            }}\n                        </div>\n                    </div>\n                    <!-- NFe Servi√ßo -->\n                    <div class=\"doc-card\">\n                        <h4>üßæ NFe Servi√ßo</h4>\n                        <div class=\"doc-preview\">\n                            {{\n                            (() => {\n                                let link = appsmith.store.itemSelecionado?.nfe_servico_pdf;\n                                \n                                // Verifica√ß√£o completa para valores inv√°lidos\n                                if (!link || link === null || link === undefined || link === 'null' || link === 'undefined' || String(link).trim() === '' || link === 'comprovante n√£o anexado') {\n                                    return '<p class=\"doc-unavailable\">Sem Anexo</p>';\n                                }\n                                \n                                link = String(link).trim().replace(/[\\r\\n\\t]/g, '');\n                                const isImage = /\\.(jpg|jpeg|png|gif|webp)$/i.test(link);\n                                \n                                if (isImage) {\n                                    return '<div class=\"img-container\"><a href=\"' + link + '\" target=\"_blank\"><img src=\"' + link + '\" alt=\"NFe Servi√ßo\" class=\"img-thumbnail\" onerror=\"this.parentElement.innerHTML=\\'<p class=doc-unavailable>Sem Anexo</p>\\'\" /></a><div class=\"img-label\">üñºÔ∏è Clique para ampliar</div></div>';\n                                } else {\n                                    let previewImg = link;\n                                    if (link.includes('cloudinary.com') && link.includes('/pdfs/')) {\n                                        previewImg = link.replace('/upload/', '/upload/f_jpg,pg_1,w_400,q_auto/');\n                                    }\n                                    return '<div class=\"img-container\"><a href=\"' + link + '\" target=\"_blank\"><img src=\"' + previewImg + '\" alt=\"Preview NFe\" class=\"img-thumbnail\" onerror=\"this.src=\\'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22150%22%3E%3Crect fill=%22%23f0f0f0%22 width=%22200%22 height=%22150%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 font-family=%22Arial%22 font-size=%2224%22 fill=%22%23999%22%3Eüßæ NFe%3C/text%3E%3C/svg%3E\\'\" /></a><div class=\"img-label\">üì• Clique para abrir NFe</div></div>';\n                                }\n                            })()\n                            }}\n                        </div>\n                    </div>\n\n                    <!-- NFe Produtos -->\n                    <div class=\"doc-card\">\n                        <h4>üßæ NFe Produtos</h4>\n                        <div class=\"doc-preview\">\n                            {{\n                            (() => {\n                                let link = appsmith.store.itemSelecionado?.nfe_produtos_pdf;\n                                \n                                // Verifica√ß√£o completa para valores inv√°lidos\n                                if (!link || link === null || link === undefined || link === 'null' || link === 'undefined' || String(link).trim() === '' || link === 'comprovante n√£o anexado') {\n                                    return '<p class=\"doc-unavailable\">Sem Anexo</p>';\n                                }\n                                \n                                link = String(link).trim().replace(/[\\r\\n\\t]/g, '');\n                                const isImage = /\\.(jpg|jpeg|png|gif|webp)$/i.test(link);\n                                \n                                if (isImage) {\n                                    return '<div class=\"img-container\"><a href=\"' + link + '\" target=\"_blank\"><img src=\"' + link + '\" alt=\"NFe Produtos\" class=\"img-thumbnail\" onerror=\"this.parentElement.innerHTML=\\'<p class=doc-unavailable>Sem Anexo</p>\\'\" /></a><div class=\"img-label\">üñºÔ∏è Clique para ampliar</div></div>';\n                                } else {\n                                    let previewImg = link;\n                                    if (link.includes('cloudinary.com') && link.includes('/pdfs/')) {\n                                        previewImg = link.replace('/upload/', '/upload/f_jpg,pg_1,w_400,q_auto/');\n                                    }\n                                    return '<div class=\"img-container\"><a href=\"' + link + '\" target=\"_blank\"><img src=\"' + previewImg + '\" alt=\"Preview NFe\" class=\"img-thumbnail\" onerror=\"this.src=\\'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22150%22%3E%3Crect fill=%22%23f0f0f0%22 width=%22200%22 height=%22150%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 font-family=%22Arial%22 font-size=%2224%22 fill=%22%23999%22%3Eüßæ NFe%3C/text%3E%3C/svg%3E\\'\" /></a><div class=\"img-label\">üì• Clique para abrir NFe</div></div>';\n                                }\n                            })()\n                            }}\n                        </div>\n                    </div>\n\n                    <!-- Foto Comprovante -->\n                    <div class=\"doc-card\">\n                        <h4>üì∑ Comprovante Pagamento</h4>\n                        <div class=\"doc-preview\">\n                            {{\n                            (() => {\n                                let link = appsmith.store.itemSelecionado?.foto_comprovante;\n                                \n                                // Verifica√ß√£o completa para valores inv√°lidos\n                                if (!link || link === null || link === undefined || link === 'null' || link === 'undefined' || String(link).trim() === '') {\n                                    return '<p class=\"doc-unavailable\">Sem Anexo</p>';\n                                }\n                                \n                                link = String(link).trim().replace(/[\\r\\n\\t]/g, '');\n                                const isImage = /\\.(jpg|jpeg|png|gif|webp)$/i.test(link);\n                                \n                                if (isImage) {\n                                    return '<div class=\"img-container\"><a href=\"' + link + '\" target=\"_blank\"><img src=\"' + link + '\" alt=\"Comprovante\" class=\"img-thumbnail\" onerror=\"this.parentElement.innerHTML=\\'<p class=doc-unavailable>Sem Anexo</p>\\'\" /></a><div class=\"img-label\">üñºÔ∏è Clique para ampliar</div></div>';\n                                } else {\n                                    let previewImg = link;\n                                    if (link.includes('cloudinary.com') && link.includes('/pdfs/')) {\n                                        previewImg = link.replace('/upload/', '/upload/f_jpg,pg_1,w_400,q_auto/');\n                                    }\n                                    return '<div class=\"img-container\"><a href=\"' + link + '\" target=\"_blank\"><img src=\"' + previewImg + '\" alt=\"Preview Comprovante\" class=\"img-thumbnail\" onerror=\"this.src=\\'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22150%22%3E%3Crect fill=%22%23f0f0f0%22 width=%22200%22 height=%22150%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 font-family=%22Arial%22 font-size=%2224%22 fill=%22%23999%22%3EüìÑ PDF%3C/text%3E%3C/svg%3E\\'\" /></a><div class=\"img-label\">üì• Clique para abrir PDF</div></div>';\n                                }\n                            })()\n                            }}\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n                <!-- Observa√ß√µes -->\n                {{\n                (() => {\n                const obs = appsmith.store.itemSelecionado?.observacoes;\n                if (obs && obs !== 'null' && String(obs).trim() !== '') {\n                return `\n                <div class=\"section-box\"\n                    style=\"background: linear-gradient(135deg, #E8F5E9, #C8E6C9); border-color: #4CAF50;\">\n                    <h3>üìù Observa√ß√µes</h3>\n                    <p>${obs}</p>\n                </div>\n                `;\n                }\n                return '';\n                })()\n                }}\n\n                <!-- Motivo da Reprova√ß√£o/Aprova√ß√£o -->\n                {{\n                (() => {\n                const motivo = appsmith.store.itemSelecionado?.motivo_reprovacao;\n                if (motivo && motivo !== 'null' && motivo !== 'NULL' && String(motivo).trim() !== '') {\n                return `\n                <div class=\"section-box\"\n                    style=\"background: linear-gradient(135deg, #FFEBEE, #FFCDD2); border-color: #F44336;\">\n                    <h3>‚ùå Motivo da Reprova√ß√£o / Aprova√ß√£o</h3>\n                    <p>${motivo}</p>\n                </div>\n                `;\n                }\n                return '';\n                })()\n                }}\n            </div>\n\n            <!-- Se√ß√£o de A√ß√µes -->\n\n            <!-- Footer -->\n            <div class=\"footer\">\n                <div class=\"footer-info\">\n                    <strong>Sistema de Gest√£o de Frotas</strong> - Or√ßamento Completo\n                </div>\n                <div class=\"footer-info\">\n                    Gerado em: {{new Date().toLocaleString('pt-BR')}}\n                </div>\n                <div class=\"footer-info\">\n                    Solicita√ß√£o ID: {{appsmith.store.itemSelecionado?.id_solicitacao}}\n                </div>\n            </div>\n        </div>\n\n        <!-- MODAL TELA CHEIA - GALERIA DE FOTOS -->\n        <div class=\"modal-fullscreen\" id=\"modalGaleria\">\n            <button class=\"modal-close-btn\" onclick=\"fecharGaleria()\">‚úï</button>\n            <div class=\"modal-foto-title\" id=\"galeriaTitle\">Foto</div>\n            <img id=\"galeriaImagem\" src=\"\" alt=\"Imagem ampliada\" />\n            <div class=\"modal-counter\" id=\"galeriaContador\"></div>\n            <div class=\"modal-nav\" id=\"galeriaBotoes\">\n                <button onclick=\"fotoAnterior()\">‚óÄ Anterior</button>\n                <button onclick=\"proximaFoto()\">Pr√≥xima ‚ñ∂</button>\n            </div>\n            <div class=\"modal-nav\">\n                <button onclick=\"abrirNovaAbaFoto()\">üîó Abrir em Nova Aba</button>\n                <button onclick=\"downloadFoto()\">üì• Download</button>\n            </div>\n        </div>\n\n        <!-- MODAL V√çDEO TELA CHEIA -->\n        <div class=\"modal-video\" id=\"modalVideo\">\n            <button class=\"modal-close-btn\" onclick=\"fecharVideo()\">‚úï</button>\n            <div class=\"modal-foto-title\">V√≠deo do Or√ßamento</div>\n            <video id=\"videoTelaCheia\" controls autoplay></video>\n            <div class=\"modal-nav\">\n                <button onclick=\"fecharVideo()\">‚úï Fechar</button>\n                <button onclick=\"downloadVideo()\">üì• Baixar V√≠deo</button>\n                <button onclick=\"abrirNovaAbaVideo()\">üîó Abrir em Nova Aba</button>\n            </div>\n        </div>\n\n        <!-- Modal de Visualiza√ß√£o (Original) -->\n        <div class=\"modal-overlay\" id=\"imageModal\" onclick=\"closeModal(event)\">\n            <div class=\"modal-content\">\n                <span class=\"modal-title\" id=\"modalTitle\">Preview</span>\n                <button class=\"modal-close\" onclick=\"closeModal(event)\">√ó</button>\n                <img class=\"modal-image\" id=\"modalImage\" src=\"\" alt=\"Preview\" onclick=\"toggleZoom(event)\" />\n                <div class=\"modal-actions\">\n                    <button class=\"modal-btn\" onclick=\"downloadImage()\">üì• Baixar Arquivo Original</button>\n                    <button class=\"modal-btn\" onclick=\"openInNewTab()\">üîó Abrir PDF em Nova Aba</button>\n                </div>\n            </div>\n        </div>\n\n        <script>\n            let currentImageUrl = '';\n            let currentTitle = '';\n\n            function openModal(imageUrl, title, originalPdfUrl) {\n                const modal = document.getElementById('imageModal');\n                const modalImage = document.getElementById('modalImage');\n                const modalTitle = document.getElementById('modalTitle');\n\n                currentImageUrl = originalPdfUrl || imageUrl; // Usa o PDF original se fornecido\n                currentTitle = title;\n\n                modalImage.src = imageUrl;\n                modalImage.classList.remove('zoomed');\n                modalTitle.textContent = title;\n                modal.classList.add('active');\n\n                // Previne scroll do body\n                document.body.style.overflow = 'hidden';\n            }\n\n            function closeModal(event) {\n                if (event) {\n                    event.stopPropagation();\n                    // Fecha apenas se clicar fora da imagem\n                    if (event.target.id === 'imageModal' || event.target.classList.contains('modal-close')) {\n                        const modal = document.getElementById('imageModal');\n                        modal.classList.remove('active');\n                        document.body.style.overflow = 'auto';\n                    }\n                }\n            }\n\n            function toggleZoom(event) {\n                event.stopPropagation();\n                const image = document.getElementById('modalImage');\n                image.classList.toggle('zoomed');\n            }\n\n            // ========== FUN√á√ïES DE DOWNLOAD UNIVERSAIS ==========\n            function forcarDownload(url, nomeArquivo) {\n                if (!url) {\n                    alert('URL n√£o dispon√≠vel para download');\n                    return;\n                }\n                \n                let downloadUrl = url;\n                \n                // Para Cloudinary, usa fl_attachment para for√ßar download\n                if (downloadUrl.includes('cloudinary.com') && downloadUrl.includes('/upload/')) {\n                    // Extrai as partes da URL\n                    const uploadIndex = downloadUrl.indexOf('/upload/');\n                    const baseUrl = downloadUrl.substring(0, uploadIndex + 8); // inclui '/upload/'\n                    const restUrl = downloadUrl.substring(uploadIndex + 8);\n                    \n                    // Verifica se j√° tem transforma√ß√µes (cont√©m '/' antes do nome do arquivo)\n                    const lastSlash = restUrl.lastIndexOf('/');\n                    if (lastSlash > 0) {\n                        // Tem transforma√ß√µes, adiciona fl_attachment no in√≠cio\n                        downloadUrl = baseUrl + 'fl_attachment/' + restUrl;\n                    } else {\n                        // N√£o tem transforma√ß√µes, adiciona fl_attachment\n                        downloadUrl = baseUrl + 'fl_attachment/' + restUrl;\n                    }\n                }\n                \n                console.log('Download URL:', downloadUrl);\n                \n                // Tenta abrir em nova aba (melhor para arquivos grandes)\n                window.open(downloadUrl, '_blank');\n            }\n\n            function downloadImage() {\n                forcarDownload(currentImageUrl, currentTitle || 'orcamento');\n            }\n\n            function openInNewTab() {\n                window.open(currentImageUrl, '_blank');\n            }\n\n            // Fechar modal com ESC\n            document.addEventListener('keydown', function (event) {\n                if (event.key === 'Escape') {\n                    const modal = document.getElementById('imageModal');\n                    if (modal.classList.contains('active')) {\n                        modal.classList.remove('active');\n                        document.body.style.overflow = 'auto';\n                    }\n                    fecharGaleria();\n                    fecharVideo();\n                }\n                // Navega√ß√£o com setas\n                if (event.key === 'ArrowLeft') fotoAnterior();\n                if (event.key === 'ArrowRight') proximaFoto();\n            });\n\n            // ========== GALERIA DE FOTOS ==========\n            let fotosGaleria = [];\n            let fotoAtualIndex = 0;\n\n            function abrirGaleria(index, fotosBase64) {\n                // Recebe as fotos como Base64 encoded JSON\n                try {\n                    if (fotosBase64) {\n                        const jsonStr = decodeURIComponent(atob(fotosBase64));\n                        fotosGaleria = JSON.parse(jsonStr);\n                    }\n                } catch (e) {\n                    console.error('Erro ao parsear fotos:', e);\n                    alert('Erro ao abrir galeria');\n                    return;\n                }\n                \n                if (!fotosGaleria || fotosGaleria.length === 0) {\n                    console.error('Nenhuma foto dispon√≠vel');\n                    alert('Nenhuma foto dispon√≠vel');\n                    return;\n                }\n                \n                fotoAtualIndex = index || 0;\n                atualizarGaleria();\n                \n                document.getElementById('modalGaleria').classList.add('active');\n                document.body.style.overflow = 'hidden';\n            }\n\n            function atualizarGaleria() {\n                const img = document.getElementById('galeriaImagem');\n                const contador = document.getElementById('galeriaContador');\n                const titulo = document.getElementById('galeriaTitle');\n                const botoes = document.getElementById('galeriaBotoes');\n                \n                img.src = fotosGaleria[fotoAtualIndex];\n                titulo.textContent = 'Foto ' + (fotoAtualIndex + 1);\n                contador.textContent = (fotoAtualIndex + 1) + ' de ' + fotosGaleria.length;\n                \n                // Mostra/esconde bot√µes de navega√ß√£o se s√≥ tem 1 foto\n                botoes.style.display = fotosGaleria.length > 1 ? 'flex' : 'none';\n            }\n\n            function fotoAnterior() {\n                if (fotosGaleria.length === 0) return;\n                fotoAtualIndex = (fotoAtualIndex - 1 + fotosGaleria.length) % fotosGaleria.length;\n                atualizarGaleria();\n            }\n\n            function proximaFoto() {\n                if (fotosGaleria.length === 0) return;\n                fotoAtualIndex = (fotoAtualIndex + 1) % fotosGaleria.length;\n                atualizarGaleria();\n            }\n\n            function fecharGaleria() {\n                document.getElementById('modalGaleria').classList.remove('active');\n                document.body.style.overflow = 'auto';\n            }\n\n            function abrirNovaAbaFoto() {\n                if (fotosGaleria[fotoAtualIndex]) {\n                    window.open(fotosGaleria[fotoAtualIndex], '_blank');\n                }\n            }\n\n            function downloadFoto() {\n                if (fotosGaleria[fotoAtualIndex]) {\n                    forcarDownload(fotosGaleria[fotoAtualIndex], 'foto_' + (fotoAtualIndex + 1));\n                }\n            }\n\n            // Fechar galeria clicando fora\n            document.getElementById('modalGaleria').addEventListener('click', function(e) {\n                if (e.target === this) fecharGaleria();\n            });\n\n            // ========== V√çDEO TELA CHEIA ==========\n            let videoAtualUrl = '';\n\n            function abrirVideoTelaCheia(url) {\n                videoAtualUrl = url;\n                const video = document.getElementById('videoTelaCheia');\n                video.src = url;\n                document.getElementById('modalVideo').classList.add('active');\n                document.body.style.overflow = 'hidden';\n            }\n\n            function fecharVideo() {\n                const video = document.getElementById('videoTelaCheia');\n                video.pause();\n                video.src = '';\n                document.getElementById('modalVideo').classList.remove('active');\n                document.body.style.overflow = 'auto';\n            }\n\n            function abrirNovaAbaVideo() {\n                if (videoAtualUrl) {\n                    window.open(videoAtualUrl, '_blank');\n                }\n            }\n\n            function downloadVideo() {\n                if (videoAtualUrl) {\n                    forcarDownload(videoAtualUrl, 'video_orcamento');\n                }\n            }\n\n            // Fechar v√≠deo clicando fora\n            document.getElementById('modalVideo').addEventListener('click', function(e) {\n                if (e.target === this) fecharVideo();\n            });\n\n            function abrirCanvas24() {\n                navigateTo(\"Canvas24\");\n            }\n        </script>\n\n\n\n</body>\n\n</html>",
  "topRow": 0,
  "type": "IFRAME_WIDGET",
  "version": 1,
  "widgetId": "6eucoswnio",
  "widgetName": "mf_detalhes_iframe"
}