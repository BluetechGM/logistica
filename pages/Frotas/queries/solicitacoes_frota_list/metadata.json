{
  "gitSyncId": "684accaaccd99e1ff73d47d3_239b6479-827f-4b97-85be-e8873fa0b320",
  "id": "Frotas_solicitacoes_frota_list",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "WITH produtos AS (\n    SELECT \n        p.id_solicitacao,\n        COUNT(*) AS quantidade_produtos,\n        COALESCE(SUM(p.preco), 0) AS valor_total_produtos,\n        COALESCE(AVG(p.preco), 0) AS valor_medio_produtos,\n        COALESCE(MIN(p.preco), 0) AS menor_preco_produto,\n        COALESCE(MAX(p.preco), 0) AS maior_preco_produto,\n        STRING_AGG(DISTINCT p.peca, ', ') AS lista_produtos,\n        STRING_AGG(DISTINCT p.marca, ', ') AS lista_marcas\n    FROM compras_so.produtos_solicitacao p\n    WHERE p.ativo = TRUE\n    GROUP BY p.id_solicitacao\n),\nrps_aggregado AS (\n    SELECT \n        rps.id_solicitacao,\n        MAX(rps.decisao) AS decisao\n    FROM logistica_ai.resultados_produtos_solicitacao rps\n    GROUP BY rps.id_solicitacao\n)\nSELECT \n    s.id AS solicitacao_id,\n    s.placa,\n    s.odometro_atual,\n    s.odometro_prox_troca,\n    s.data_prox_manutencao,\n    s.cidade,\n    s.criado_por,\n    s.servico,\n    s.status,\n    s.motivo_reprovacao,\n    s.data_abertura,\n    s.id_solicitacao,\n    s.filial_id,\n    s.id_solicitante,\n    s.nome_solicitante,\n    s.link_orcamento_pdf,\n    s.link_fotos_orcamento,\n    s.link_video_orcamento,\n    s.link_imagem_orcamento,\n    s.nfe_servico_pdf,\n    s.nfe_produtos_pdf,\n    s.observacoes,\n    s.tipo_incidente,\n    s.foto_comprovante,\n    s.lancado_winthor,\n    s.cnpj,\n    s.chave_pix,\n    s.recnum,\n    s.foto_reparo,\n    s.video_reparo,\n    COALESCE(p.quantidade_produtos, 0) AS quantidade_produtos,\n    COALESCE(p.valor_total_produtos, 0) AS valor_total_produtos,\n    COALESCE(p.valor_medio_produtos, 0) AS valor_medio_produtos,\n    COALESCE(p.menor_preco_produto, 0) AS menor_preco_produto,\n    COALESCE(p.maior_preco_produto, 0) AS maior_preco_produto,\n    COALESCE(p.lista_produtos, '') AS lista_produtos,\n    COALESCE(p.lista_marcas, '') AS lista_marcas,\n    rps.decisao\nFROM compras_so.solicitacoes_frota s\nLEFT JOIN produtos p\n       ON p.id_solicitacao = s.id_solicitacao\nLEFT JOIN rps_aggregado rps\n       ON rps.id_solicitacao = s.id_solicitacao\nWHERE \n    s.ativo = TRUE\n    AND (\n        {{appsmith.store.permissao_query}} = TRUE\n        OR s.id_solicitante = '{{appsmith.store.matricula}}'\n    )\nORDER BY s.data_abertura DESC;",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": false
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "CANDIDATOS",
      "isAutoGenerated": false,
      "name": "CANDIDATOS",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "name": "solicitacoes_frota_list",
    "pageId": "Frotas",
    "runBehaviour": "ON_PAGE_LOAD",
    "userSetOnLoad": true
  }
}