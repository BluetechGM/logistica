{
  "gitSyncId": "684accaaccd99e1ff73d47d3_239b6479-827f-4b97-85be-e8873fa0b320",
  "id": "Frotas_solicitacoes_frota_list",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "SELECT \n    s.id as solicitacao_id,\n    s.placa,\n    s.odometro_atual,\n    s.odometro_prox_troca,\n    s.data_prox_manutencao,\n    s.cidade,\n    s.criado_por,\n    s.servico,\n    s.status,\n    s.motivo_reprovacao,\n    s.data_abertura,\n    s.id_solicitacao,\n    s.filial_id,\n    s.id_solicitante,\n    s.nome_solicitante,\n    s.link_orcamento_pdf,\n    s.link_fotos_orcamento,\n    s.nfe_servico_pdf,\n    s.nfe_produtos_pdf,\n    s.observacoes,\n    s.tipo_incidente,\n    s.foto_comprovante,\n    s.lancado_winthor,\n    s.recnum,\n\n    COUNT(p.id) as quantidade_produtos,\n    COALESCE(SUM(p.preco), 0) as valor_total_produtos,\n    COALESCE(AVG(p.preco), 0) as valor_medio_produtos,\n    COALESCE(MIN(p.preco), 0) as menor_preco_produto,\n    COALESCE(MAX(p.preco), 0) as maior_preco_produto,\n    STRING_AGG(DISTINCT p.peca, ', ') as lista_produtos,\n    STRING_AGG(DISTINCT p.marca, ', ') as lista_marcas,\n\n    -- ðŸ”¥ Campo vindo do schema logistica_ai\n    MAX(rps.decisao) AS decisao\n\nFROM compras_so.solicitacoes_frota s\n\nLEFT JOIN compras_so.produtos_solicitacao p \n       ON s.id_solicitacao = p.id_solicitacao \n      AND p.ativo = TRUE\n\nLEFT JOIN logistica_ai.resultados_produtos_solicitacao rps\n       ON s.id_solicitacao = rps.id_solicitacao\n\nWHERE \n    s.ativo = TRUE\n    AND (\n        {{appsmith.store.permissao_query}} = TRUE\n        OR s.id_solicitante = '{{appsmith.store.matricula}}'\n    )\n\nGROUP BY \n    s.id, s.placa, s.odometro_atual, s.odometro_prox_troca, \n    s.data_prox_manutencao, s.cidade, s.criado_por, s.servico, \n    s.status, s.motivo_reprovacao, s.data_abertura, s.id_solicitacao,\n    s.filial_id, s.id_solicitante, s.nome_solicitante, \n    s.link_orcamento_pdf, s.link_fotos_orcamento, \n    s.nfe_servico_pdf, s.nfe_produtos_pdf,\n    s.observacoes, s.tipo_incidente, s.foto_comprovante,\n    s.lancado_winthor, s.recnum\n\nORDER BY s.data_abertura DESC;\n",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": false
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "CANDIDATOS",
      "isAutoGenerated": false,
      "name": "CANDIDATOS",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "name": "solicitacoes_frota_list",
    "pageId": "Frotas",
    "runBehaviour": "ON_PAGE_LOAD",
    "userSetOnLoad": true
  }
}