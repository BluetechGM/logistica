{
  "gitSyncId": "684accaaccd99e1ff73d47d3_24e728e1-3ac1-47c2-9f91-56d3d3467a2c",
  "id": "Frotas_solicitacoes_frota",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "export default {\n  validarCampos() {\n    const mensagens = [];\n\n    // ---- Campos do formulário ----\n    if (!Select_placa.selectedOptionLabel) {\n      mensagens.push(\"⚠️ Placa não informada\");\n    }\n\t\tif (!foto_orcamento_pdf_ou_imagem.data.secure_url) {\n      mensagens.push(\"⚠️ Voce precisa anexar o pdf ou foto do Orçamento\");\n    }\n    if (!Input_OdometroAtual.text || isNaN(Number(Input_OdometroAtual.text))) {\n      mensagens.push(\"⚠️ Odômetro atual inválido ou não informado\");\n    }\n    if (!Select_Cidade.selectedOptionLabel) {\n      mensagens.push(\"⚠️ Cidade não selecionada\");\n    }\n    if (!appsmith.store.usuario_nome) {\n      mensagens.push(\"⚠️ Nome do responsável não informado\");\n    }\n    if (!MultiSelect1.selectedOptionLabels) {\n      mensagens.push(\"⚠️ Serviço não selecionado\");\n    }\n\n    // ---- Produtos obrigatórios ----\n    const produtos = appsmith.store?.produtos;\n    if (!Array.isArray(produtos) || produtos.length === 0) {\n      mensagens.push(\"⚠️ Adicione pelo menos um produto à solicitação\");\n    } else {\n      // validação mínima de cada produto\n      const invalidos = produtos\n        .map((p, idx) => ({ p, idx: idx + 1 }))\n        .filter(({ p }) =>\n          !p?.id ||\n          !p?.peca ||\n          p?.preco === undefined ||\n          p?.preco === null ||\n          isNaN(Number(p.preco))\n        );\n\n      if (invalidos.length > 0) {\n        mensagens.push(\n          `⚠️ Existem produtos com dados incompletos/invalidos: itens ${invalidos.map(i => i.idx).join(\", \")}`\n        );\n      }\n    }\n\n    if (mensagens.length > 0) {\n      showAlert(mensagens.join(\"\\n\"), \"error\");\n      return false;\n    }\n    return true;\n  },\n\n  // (Opcional) Monta o payload que você pode enviar para sua query\n  getPayload() {\n    return {\n      Placa: Select_placa.selectedOptionLabel,\n      OdometroAtual: Number(Input_OdometroAtual.text),\n      Cidade: Select_Cidade.selectedOptionLabel,\n      CriadoPor: appsmith.store.usuario_nome,\n      Servico: MultiSelect1.selectedOptionLabels,\n      Produtos: appsmith.store?.produtos ?? []\n    };\n  },\n\n  async salvarSolicitacao() {\n    const valido = this.validarCampos();\n    if (!valido) return;\n\n    try {\n      // Se suas actions aceitarem parâmetros, descomente e adeque:\n      // await inserir_produtos.run(this.getPayload());\n      await solicitacoes_produtos.run();\n\t\t\t\n\n      // Se precisar enviar os produtos especificamente:\n      // await inserir_produtos.run({ produtos: appsmith.store.produtos });\n\n      await solicitacoes_frota.run();\n\t\t\tshowAlert('Registrado com sucesso', 'success'); \n\t\t\tlista_produtos.limpar_lista();\n\t\t\tresetWidget('Modal_solicitacoes');\n\t\t\tcloseModal('Modal_solicitacoes');\n\n    } catch (err) {\n      showAlert(\"❌ Erro ao salvar: \" + (err?.message ?? err), \"error\");\n    }\n  }\n};\n\n\n\n",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": false
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "CANDIDATOS",
      "isAutoGenerated": false,
      "name": "CANDIDATOS",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [],
    "name": "solicitacoes_frota",
    "pageId": "Frotas",
    "runBehaviour": "MANUAL",
    "userSetOnLoad": false
  }
}